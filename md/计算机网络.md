# 计算机网络

## 网络性能

## 体系结构

计算机网络体系结构分为3种：OSI体系结构（七层），TCP/IP体系结构（四层），五层体系结构。

- `OSI体系结构`: 概念清楚，理论也比较完整，但是它既复杂又不实用。
- `TCP/IP体系结构`:TCP/IP是一个四层体系结构，得到了广泛的运用。
- `五层体系结构`:为了方便学习，折中`OSI体系结构`和`TCP/IP体系结构`，综合二者的优点，这样既简洁，又能将概念讲清楚。

[![ppAWa3n.jpg](https://s1.ax1x.com/2023/03/04/ppAWa3n.jpg)](https://imgse.com/i/ppAWa3n)

- 应用层：通过应用进程间的交互来完成特定网络应用；
- 运输层：负责向两台主机中进程之间的通信提供则用的数据传输服务，TCP提供面向连接的、可靠的数据传输服务，传输单位为报文段；UDP提供无连接的尽最努力的数据传输服务，传输单位为用户数据报；
- 网络层：提供主机间的通信服务。路由器生成转发表，依据转发表转发分组至下一个路由器；
- 数据链路层：直连网络中相邻节点的链路上传输帧；
- 物理层：实现比特传输。

将OSI体系中的会话层、表示层、应用层合并为应用层后即为五层协议体系，将物理层与数据链路层再合并为网络接口层即为TCP/IP的四层协议体系，TCP/IP协议体系不严格遵循OSI分层概念，应用层可能会直接使用IP层或网络接口层。
五层协议体系

以五层协议体系为例，叙述各层功能：

    应用层：为特定应用程序提供数据传输服务
    运输层：为进程提供通用数据传输服务
    网络层：为主机提供数据传输服务
    数据链路层：为主机间的多个链路提供数据传输服务
    物理层：数据比特流
## **3、TCP/IP体系结构概述**

TCP/IP的体系结构比较简单，只有四层。

| 层次名称 | 单  位 | 功  能 | 协  议 |
| -------- | ------ | ------ | ------ |
|          |        |        |        |



### 1 应用层

**应用层(application-layer）的任务是通过应用进程间的交互来完成特定网络应用。**应用层协议定义的是应用进程（进程：主机中正在运行的程序）间的通信和交互的规则。对于不同的网络应用需要不同的应用层协议。在互联网中应用层协议很多，如**域名系统DNS**，支持万维网应用的 **HTTP协议**，支持电子邮件的 **SMTP协议**等等。我们把应用层交互的数据单元称为报文。

### 域名系统

>  域名系统(Domain Name System缩写 DNS，Domain  Name被译为域名)是因特网的一项核心服务，它作为可以将域名和IP地址相互映射的一个分布式数据库，能够使人更方便的访问互联网，而不用去记住能够被机器直接读取的IP数串。（百度百科）例如：一个公司的 Web  网站可看作是它在网上的门户，而域名就相当于其门牌地址，通常域名都使用该公司的名称或简称。例如上面提到的微软公司的域名，类似的还有：IBM  公司的域名是 http://www.ibm.com、Oracle 公司的域名是 http://www.oracle.com、Cisco公司的域名是 http://www.cisco.com 等。
>  

### HTTP协议

>  超文本传输协议（HTTP，HyperText Transfer Protocol)是互联网上应用最为广泛的一种网络协议。所有的  WWW（万维网） 文件都必须遵守这个标准。设计 HTTP 最初的目的是为了提供一种发布和接收 HTML 页面的方法。（百度百科）

### 2 运输层

**运输层(transport layer)的主要任务就是负责向两台主机进程之间的通信提供通用的数据传输服务**。应用进程利用该服务传送应用层报文。“通用的”是指并不针对某一个特定的网络应用，而是多种应用可以使用同一个运输层服务。由于一台主机可同时运行多个线程，因此运输层有复用和分用的功能。所谓复用就是指多个应用层进程可同时使用下面运输层的服务，分用和复用相反，是运输层把收到的信息分别交付上面应用层中的相应进程。

### 运输层主要使用以下两种协议

1. **传输控制协议 TCP**（Transmisson Control Protocol）--提供**面向连接**的，**可靠的**数据传输服务。
2. **用户数据协议 UDP**（User Datagram Protocol）--提供**无连接**的，尽最大努力的数据传输服务（**不保证数据传输的可靠性**）。

### UDP 的主要特点

1. UDP 是无连接的；
2. UDP 使用尽最大努力交付，即不保证可靠交付，因此主机不需要维持复杂的链接状态（这里面有许多参数）；
3. UDP 是面向报文的；
4. UDP 没有拥塞控制，因此网络出现拥塞不会使源主机的发送速率降低（对实时应用很有用，如 直播，实时视频会议等）；
5. UDP 支持一对一、一对多、多对一和多对多的交互通信；
6. UDP 的首部开销小，只有8个字节，比TCP的20个字节的首部要短。

### TCP 的主要特点

1. TCP 是面向连接的。（就好像打电话一样，通话前需要先拨号建立连接，通话结束后要挂机释放连接）；
2. 每一条 TCP 连接只能有两个端点，每一条TCP连接只能是点对点的（一对一）；
3. TCP 提供可靠交付的服务。通过TCP连接传送的数据，无差错、不丢失、不重复、并且按序到达；
4. TCP 提供全双工通信。TCP 允许通信双方的应用进程在任何时候都能发送数据。TCP 连接的两端都设有发送缓存和接收缓存，用来临时存放双方通信的数据；
5. 面向字节流。TCP 中的“流”（Stream）指的是流入进程或从进程流出的字节序列。“面向字节流”的含义是：虽然应用程序和 TCP 的交互是一次一个数据块（大小不等），但 TCP 把应用程序交下来的数据仅仅看成是一连串的无结构的字节流。

### 3 网络层

**在 计算机网络中进行通信的两个计算机之间可能会经过很多个数据链路，也可能还要经过很多通信子网。网络层的任务就是选择合适的网间路由和交换结点， 确保数据及时传送。** 在发送数据时，网络层把运输层产生的报文段或用户数据报封装成分组和包进行传送。在 TCP/IP 体系结构中，由于网络层使用 **IP 协议**，因此分组也叫 **IP 数据报** ，简称 **数据报**。

这里要注意：**不要把运输层的“用户数据报 UDP ”和网络层的“ IP 数据报”弄混**。另外，无论是哪一层的数据单元，都可笼统地用“分组”来表示。

这里强调指出，网络层中的“网络”二字已经不是我们通常谈到的具体网络，而是指计算机网络体系结构模型中第三层的名称.

互联网是由大量的异构（heterogeneous）网络通过路由器（router）相互连接起来的。互联网使用的网络层协议是无连接的网际协议（Intert Prococol）和许多路由选择协议，因此互联网的网络层也叫做**网际层**或**IP层**。

### 4 数据链路层

**数据链路层(data link layer)通常简称为链路层。两台主机之间的数据传输，总是在一段一段的链路上传送的，这就需要使用专门的链路层的协议。** 在两个相邻节点之间传送数据时，**数据链路层将网络层交下来的 IP 数据报组装程帧**，在两个相邻节点间的链路上传送帧。每一帧包括数据和必要的控制信息（如同步信息，地址信息，差错控制等）。

在接收数据时，控制信息使接收端能够知道一个帧从哪个比特开始和到哪个比特结束。这样，数据链路层在收到一个帧后，就可从中提出数据部分，上交给网络层。  控制信息还使接收端能够检测到所收到的帧中有误差错。如果发现差错，数据链路层就简单地丢弃这个出了差错的帧，以避免继续在网络中传送下去白白浪费网络资源。如果需要改正数据在链路层传输时出现差错（这就是说，数据链路层不仅要检错，而且还要纠错），那么就要采用可靠性传输协议来纠正出现的差错。这种方法会使链路层的协议复杂些。

### 5 物理层

在物理层上所传送的数据单位是比特。  **物理层(physical layer)的作用是实现相邻计算机节点之间比特流的透明传送，尽可能屏蔽掉具体传输介质和物理设备的差异。** 使其上面的数据链路层不必考虑网络的具体传输介质是什么。“透明传送比特流”表示经实际电路传送后的比特流没有发生变化，对传送的比特流来说，这个电路好像是看不见的。

在互联网使用的各种协中最重要和最著名的就是 TCP/IP 两个协议。现在人们经常提到的TCP/IP并不一定单指TCP和IP这两个具体的协议，而往往表示互联网所使用的整个TCP/IP协议族。



# 网络层

## 网际协议IP



网际协议IP是TCP/IP体系中两个最主要的协议之一。
与IP协议配套使用的还有三个协议：
	地址解析协议ARP;
	网际控制报文协议ICMP;
	网际组管理协议IGM

[![ppAXINn.jpg](https://s1.ax1x.com/2023/03/04/ppAXINn.jpg)](https://imgse.com/i/ppAXINn)

### IP

IP所提供的服务通常被认为是无连接的和不可靠的，它将差错控制和流量控制之类的服务授权给了其他的各层协议，这正是TCP/IP 能够高效率工作的一个重要保证。网络层的功能主要由IP来提供，除了提供端到端的分组分发功能外，IP还提供很多扩充功能。例如，为了克服数据链路层对帧大小的限制，网络层提供了数据分块和重组功能，这使得很大的IP数据包能以较小的分组在网络上传输。

## IP协议

- 对于网络层，**IP协议**是其中一个非常重要的协议
- IP协议使得复杂的实际网络变为一个**虚拟互联的网络**（也就是我们只需要将终端设备连接到这个网络中去即可，并不需要关心里边实际的复杂网络）
- IP协议使得网络层可以**屏蔽底层细节**而专注网络层的**数据转发**（如果单从网络层去看，我们是不用关心**数据包**是通过海底电缆还是通过无线WiFi传输到目的计算机的）
- IP协议**解决了在虚拟网络中数据报传输路径的问题**

在**网络层**，同样也有一个地址的概念，这个地址称之为**IP地址**。IP地址总共有32位，一般用**点分十进制**表示。也可以展开成二进制的格式

**IP地址**

- IP地址长度为**32位**，常分成**4个8位**
- IP地址常使用**点分十进制**来表示（0~255.0~255.0~255.0~255，通过计算可以知道，最多可以表示2的32次方个IP地址，大概42亿）

**IP协议**

在了解**IP协议**之前，先看一下IP协议所处的一个位置。在物理层，它传输的是0、1这样的**比特流**；在数据链路层，传输的是**数据帧**，数据帧包括帧首部、帧尾部和“帧”数据，“帧”数据主要就是IP数据报。现在对IP数据报进行详细的剖析，它将会分成**IP首部**和**IP数据报的数据**两个部分



要学习IP协议，IP协议的**首部**是非常重要的内容，后边也会重点介绍IP首部的信息。下边是IP首部的具体格式





从上图可以看出，IP首部中包含了非常多的信息，包括**版本**、**协议**、**IP地址**等。上边的每一行都是**32**个比特位，也就是**4**个字节，**前边五行是必须存在的内容**，第六行是可有可无的，第七行是IP数据。因此对IP首部来说，**至少会有20个字节的长度**

**IP首部中每一部分的含义**

- **版本**：占4位，指的是IP协议的版本，通信双方的版本必须一致，当前主流版本是4，即IPv4，也有IPv6
- **首部长度**：占4位，最大数值为15，表示的是IP首部的长度，单位是“32位字”（4个字节），也就是**IP首部**最大长度为60字节
- **服务类型**：这个一般是不需要关心的
- **总长度**：占16位，最大数值为65535，表示的是**IP数据报总长度**（IP首部+IP数据） （在前边介绍数据链路层的时候，也提到过一个长度。对于数据链路层的长度，称之为**MTU**，一般为1500字节。而IP数据报的最大长度有65535个字节，比MTU要大。如果真正传输的时候，如果出现这种情况，数据链路层会对IP数据报进行**分片**，也就是将一个较长的IP数据报拆分成多个数据帧来进行传输）
- **标识**：协议内部所使用的，无需关心
- **标记**：标记IP报文是否可以进行分片
- **片偏移**：前边有提到，如果IP数据报的长度过长，会进行IP报文的分片，把一个IP报文拆分成多个数据帧进行数据链路层的传输。因此，如果拆分的话，就需要使用**片偏移**来记录当前的数据帧，保存的**第几个偏移的IP数据**
- **TTL**：占8位，表明IP数据报文在网络中的**寿命**，每经过一个设备（不管是路由器还是计算机），TTL减一，当TTL=0时，网络设备必须**丢弃**该报文（它解决的就是，当网络报文找不到终点的时候，避免网络报文在网络中无限的传输，以消耗带宽）
- **协议**：占8位，表明IP数据所携带的具体数据是什么**协议**的（如TCP、UDP等，一些协议对应的值，可参考下图）
- **校验和**：占16位，校验IP首部是否有出错（接收方接收到IP首部之后也会进行校验，如果有错，则直接丢弃）
- **源IP地址**：**发送**IP数据报的网络设备的IP地址
- **目的IP地址**：IP数据报要**到达**的目的网络设备的IP地址

IP地址 ::= {<网络号>,<主机号>}

A类、B类和C类地址的网络号字段分别为1个、2个和3个字节长，而在网络号字段的最前面有1~3位的类别位，其数值分别规定为0，10和110。
A类、B类和C类地址的主机号字段分别为3个、2个和1个字节长。
D类地址（前4位是1110）用于多播（一对多通信）。
E类地址（前4位是1111）保留为以后用。

把IP地址划分为A类、B类、C类三个类别，当初是这样考虑的。各种网络的差异很大，有的网络拥有很多主机，而有的网络上的主机则很少。把IP地址划分为A类、B类和C类是为了更好地满足不同用户的要求。

常用的三种类型的IP地址：

A类地址的网络号字段占1个字节，只有7位可供使用，但可指派的网络号是126个（即2^{7}-2）。减2的原因是：

    第一，IP地址中网络号字段为全0的IP地址是个保留地址，意思是“本网络”；
    
    第二，网络号为127（即01111111）保留作为本地软件环回测试本主机的进程之间的通信之用。

若主机发送一个目的地址为环回地址（例如127.0.0.1）的IP数据报，则本主机中的协议软件就处理数据报中的数据，而不会把数据报发送到任何网络。

A类地址的主机号占3个字节，因此每一个A类网络中的最大主机数是2^{24}-2，即16777214。这里减2的原因是：

    第一，全0的主机号字段表示该IP地址是“本主机”所连接到的单个网络地址
    
    第二，而全1表示“所有的（all）”，因此全1的主机号字段表示该网络上的所有主机

B类地址的网络号字段有2个字节，但实际上B类网络地址128.0.0.0是不指派的，而可以指派的B类最小网络地址是128.1.0.0。因此B类地址可指派的网络数为2^{14}-2，即16383。B类地址的每一个网络上的最大主机数是2^{16}-2，即65534。这里需要减2是因为要扣除全0和全1的主机号。

C类地址有3个字节的网络号字段，还有21位可以进行分配。C类网络地址192.0.0.0也是不指派的，可以指派的C类最小网络地址是192.0.1.0，因此C类地址可指派的网络总数是2^{21}-2，即2097151。每一个C类地址的最大主机数是2^{8}-2，即254。

| 网络类别 | 最大可指派的网络数 | 第一个可指派的网络号 | 最后一个可指派的网络号 | 每个网络中的最大主机数 |
| -------- | ------------------ | -------------------- | ---------------------- | ---------------------- |
| A        | 126(2-2)           | 1                    | 126                    | 16777214               |
| B        | 16383(24-1)        | 128.1                | 191.255                | 65534                  |
| C        | 2097151(221-1)     | 192.0.1              | 223.255.255            | 254                    |

二、子网的划分

两级IP地址的缺点：

    第一，IP地址空间的利用率有时很低。
    
    第二，给每一个物理网络分配一个网络号会使路由表变得太大因而使网络性能变坏。
    
    第三，两级IP地址不够灵活

为解决这些问题，从1985年起在IP地址中又增加了一个“子网号字段”，使两级IP地址变成为三级IP地址，它能够较好地解决上述问题，并且使用起来也很灵活。这种做法叫做划分子网。

划分子网的思路如下：

    （1）一个拥有许多物理网络的单位，可将所属的物理网络划分为若干个子网。划分子网纯属一个单位内部的事情。本单位以外的网络看不见这个网络是由多少个子网组成，因为这个单位对外仍然表现为一个网络。
    
    （2）划分子网的方法是从网络的主机号借用若干位作为子网号，当然主机号也就相应减少了同样的位数。于是两级IP地址在本单位内部就变为三级IP地址：网络号、子网号和主机号。也可以用以下记法来表示：
    
    IP地址 ::= {<网络号>,<子网号>,<主机号>}
    
    （3）凡是从其他网络发送给本单位某台主机的IP数据报，仍然是根据IP数据报的目的网络号找到连接在本单位网络上的路由器。但此路由器在收到IP数据报后，再按目的网络号和子网号找到目的子网，把IP数据报交付目的主机




子网掩码

假定有一个数据报（其目的地址是145.13.3.10）已经到达了路由器R_{1}。那么这个路由器如何把它转发到子网145.13.3.0呢？

我们知道，从IP数据报的首部无法看出源主机或目的主机所连接的网络是否进行了子网的划分。这是因为32位的IP地址本身以及数据报的首部都没有包含任何有关子网划分的信息。因此必须另外想办法，这就是使用子网掩码。





为了使路由器R_{1}，能够很方便地从数据报中的目的IP地址中提取出所要找的子网的网络地址，路由器R_{1}就要使用三级IP地址的子网掩码，路由器R_{1}把三级IP地址的子网掩码和收到的数据报的目的IP地址145.13.3.10逐位相“与”（AND），得出了所要找的子网的网络地址145.13.3.0
三、超网的构成

无分类编址CIDR：

划分子网在一定程度上缓解了互联网在发展中遇到的困难。然而在1992年互联网仍然面临三个必须尽早解决的问题

    （1）B类地址在1992年已分配了近一半，眼看很快就将全部分配完毕！
    
    （2）互联网主干网上的路由表中的项目数急剧增长（从几千个增长到几万个）。
    
    （3）整个IPv4的地址空间最终将全部耗尽。

在一个划分子网的网络中可同时使用几个不同的子网掩码。使用变长子网掩码VLSM可进一步提高IP地址资源的利用率。在VLSM的基础上又进一步研究出无分类编址方法，它的正式名字是无分类域间路由选择 CIDR。

CIDR最主要的特点有两个：

    （1）CIDR 消除了传统的A类、B类和C类地址以及划分子网的概念，因而能更加有效地分配IPv4的地址空间，CIDR把32位的IP地址划分为前后两个部分。前面部分是“网络前缀”（或简称为“前缀”），用来指明网络，后面部分则用来指明主机。因此CIDR使IP地址从三级编址（使用子网掩码）又回到了两级编址，但这已是无分类的两级编址。其记法是：      
    
    IP地址 ::= {<网络前缀>,<主机号>}
    
    CIDR还使用“斜线记法”，或称为CIDR记法，即在IP地址后面加上斜线“/”，然后写上网络前缀所占的位数。
    
    （2）CIDR把网络前缀都相同的连续的IP地址组成一个“CIDR地址块”。我们只要知道CIDR地址块中的任何一个地址，就可以知道这个地址块的起始地址（即最小地址）和最大地址，以及地址块中的地址数。

例如，已知IP地址128.14.35.7/20是某CIDR地址块中的一个地址，现在把它写成二进制表示，其中的前20位是网络前缀（用粗体和下划线表示出），而前缀后面的12位是主机号：

                                128.14.35.7/20 = 10000000 00001110 00100011 00000111

 这个地址所在的地址块中的最小地址和最大地址可以很方便地得出：

### ARP

ARP(Address Resolution Protocol，地址解析协议)用于动态地完成IP地址向物理地址的转换。物理地址通常是指计算机的网卡地址，也称为MAC(Medai Access Control，媒体访问控制)地址，每块网卡都有唯一的地址。

### RARP

RARP(Reverse Address Resolution Protocol，反向地址解析协议)用于动态完成物理地址向IP地址的转换。

### ICMP

ICMP(Internet Control Message Protocol，网际控制报文协议)是一个专门用于发送差错报文的协议，由于IP协议是一种尽力传送的通信协议，即传送的数据可能丢失、重复、延迟或乱序传递，所以需要一种尽量避免差错并能在发生差错时报告的机制，这就是ICMP的功能。

### IGMP

IGMP(Internet Group Management Protocol，网际组管理协议)允许Internet中的计算机参加多播，是计算机用做向相邻多目路由器报告多组成员的协议。多目路由器是支持组播的路由器，它向本地网络发送IGMP查询，计算机通过发送IGMP报告来应答查询。多目路由器负责将组播包转发到网络中所有组播成员。

IOS的七层协议体系结构的概念清楚，理论也较完整，但它既复杂又不实用。
TCP/IP是四层体系结构：应用层、运输层、网际层和网络接口层。
但最下面的网络接口层并没有具体内容。
因此往往采取折中的办法，即综合OS和TCP/IP的优点，采用一种
只有五层协议的体系结构。

网络层介于传输层和数据链路层之间，其主要作用是实现两个网络系统之间的数据透明传送，具体包括路由选择，拥塞控制和网际互连等。网络层是网络与网络之间通信的最底层，在数据从数据链路层向传输层进行数据传输的通信中，起到构建一个中间通信子网的作用。不同网络有这不同的网络层协议和地址规范，如果一个网络中的用户不能识别其他网络的通信协议和地址规范，那么这两个网络之间就不能进行数据通信，就好比不同国家有着不同的交通法规，属于不同的交警系统管理，不允许他国车辆随便出入一样。不同网络也有不同的设计规范，属于不同的组织来管理，必须通过授权，并由专门的协议来负责网络间的通信。如果只是同一局域网内的各个计算机之间的通信，单靠物理层和数据链路层就可以建立通信链路完成用户间的数据通信，但要扩大应用范围，连接不同的局域子网，就需要借助网络层处理各个网络子网的协议，从而进行计算机的网络互连，所以网络层在TCP/IP协议体系中叫网际互连层。

从一般的概念来讲，将网络互相连起来的要使用一些中间设备。根据中间设备所在的层次，可以有以下四种不同的中间设备：
（1）物理层使用的中间设备叫转发器（repeater）
（2）数据链路层使用的中间设备叫做网桥或者桥接器（bridge）
（3）网络层使用的中间设备叫做路由器（router）
（4）在网络层以上使用的中间设备叫做网关（gateway）。用网关连接两个不兼容的系统需要在高层进行协议转换。

[![ppAXXB4.jpg](https://s1.ax1x.com/2023/03/04/ppAXXB4.jpg)](https://imgse.com/i/ppAXXB4)

网络层协议及报文格式

在TCP/IP体系结构的网际互联层，最重要的协议就是IP协议簇。

目前的计算机网络，特别是TCP/IP网络，使用最多的是数据包分组交换方式，而IP协议是用于将多个分组交换网络连接起来的最典型通信协议。IP协议是一个无连接的服务，负责在源地址和目的地址之间传送数据包，然后为了使用不同网络对分组大小的要求，需要对上层传来的报文进行分割，最后调用本地网络协议将数据包传送给下一个网关或目的计算机。

1、IP协议基本功能

IP协议是一个无连接的服务，负责在源地址和目的地址之间传送数据报，其主要功能就是把数据报在互连的网络上传送，将数据报在一个个模块间通过路由处理网络地址传送到目的地址。具体来说具备以下几方面的功能：

    寻址，在不同网络中必须通过三层地址进行寻址。常用的IP网络中运行的三层协议就是IP协议，对应的三层地址就是IP地址。
    数据报的封装，从传输层过来的数据段需要经过IP协议的重封装，而从数据链路层过来的数据帧就需要进行解封装。在IP网络中封装后形成的是IP数据报，IP封装的目的就是标识此IP数据报发送节点和接受节点的IP地址和控制信息。
    分段与重组，不同网络上的链路可以传输的最大报文大小是不同的，这就是我们通常说的MTU（最大传输单元）。尺寸较大的数据报在MTU值较小的网络链路传输需要将数据报分段依次传输，对应的接收方就需要把这些接收到的拆分的分段组合起来，还原成原来的数据报。

2、IPv4数据报格式





## 路由器





## 02 电路交换（Circuit Switching）

电路交换受电话交换的启发。

两部电话，需要一对电线；5部电话两两项链，需要10对电线；N部电话两两相连，需要 (N(N-2))

对电线。



通过**交换机**使用交换的方法，连接电话，方便彼此通信。

**⭐物理层的集线器（HUB）**的功能和交换机很像。

**电路交换三步：**

1. **建立连接：**分配通信资源。即在使用电路交换打电话前，必须先拨号请求**建立连接**。当被叫用户听到电话交换机送来的拨号音并摘机后，从主叫端建立连接，即一条**专用的物理通路**。 
2. **通话：**一直占用通信资源。
3. **释放连接：**归还通信资源。

**缺点：**线路传输效率很低，因为计算机数据是**突发式地**出现在传输线路上。一旦某条线路被占，其他用户就不能使用，宝贵的通信线路资源白白被浪费。



- 频分复用(Frequency-division multiplexing)(FDM)
- 分时复用(time-division multiplexing)(TDM)

### 频分复用

顾名思义，分的是频率。
 每个链路有一个频谱，频谱由建立在这条链路上的连接所瓜分。

具体来讲，链路将频率带分给每一个连接。

在电话网络中，这个频率带的宽度通常是4 khz(即4000 hz, 每秒4000圈）。 这个频率带的宽度叫做`带宽(bandwidth)`。

FM 收音机通常使用分频复用来共享在88MHz到108Mhz的频谱。每个电台都被分批额一个特定的频率带。

#### 带宽

链路中频率带的宽度

### 分时复用(TDM)

在分时复用机制中，时间被划分为固定长度的帧，每一帧被划分为一个固定的时间戳(time slots). 当网络在一个链路上建立一个连接之后，网络在每一帧中给这个连接分一个时间戳。
 这个时间戳专门就供这一个连接使用。

- 速率：指的是单位时间传送的比特数，其单位是 b/s(比特每秒)。一个比特(bit)就是一个二进制数字中的一个 1 或 0。 
   注：

> 比特是计算机中的最小单位，一个字节(Byte)=8个bit。 
>  1Kb = 1024bit 
>  1KB = 1024Byte 
>  1Mb = 1024 Kb 
>  1MB = 1024KB 
>  所以有 1 Mb = 0.125 MB (1/8 * MB) 
>  (注意上面的大小写)

带宽：在计算机网络中，带宽用来表示通信线路的数据传输能力，因此网络带宽指的是在单位时间内从网络中的某一点到另一点所能通过的最高速率(上面的那个,也可以称为数据率或者比特率)。

时延 
 时延指的是数据从网络的一端传送到另一端所需的时间。网络中的时延有一以下几个不同的部分组成：

1. 发送时延：主机或者路由器发送数据帧说需要的时间，由此发送时延的计算公式为： 

## IP地址与硬件地址

### **1. IP地址与硬件地址的区别**

#### **1.1 IP地址**

- IP地址是一种逻辑地址。
- IP地址称为逻辑地址，是因为IP地址是用软件实现的。
- IP地址是网络层及其以上各层(包括运输层、应用层等)使用的地址。
- IP地址放在IP数据报的首部。

#### **1.2 硬件地址**

- 硬件地址是一种物理地址。
- 硬件地址称为物理地址，是因为硬件地址是用硬件实现的。
- 硬件地址是数据链里层和物理层使用的地址。
- 硬件地址放在MAC帧的首部。

### **2. 数据中的IP地址与硬件地址**

#### **2.1 发送数据**

- 在发送数据时，数据从高层下到低层，然后才到通信链路上传输。
- 使用IP地址的IP数据报一旦交给了数据链路层，就被封装成MAC帧了。
- MAC帧在传送时使用的源地址和目的地址都是硬件地址，这两个硬件地址都写在MAC帧的首部。
- 当IP数据报放入到数据链路层的MAC帧中以后，整个IP数据报就成了MAC帧的数据部分，因而在数据链路层看不见IP数据报的IP地址。 








#### **2.2 接收数据**

- 在接收数据时，数据从低层上到高层。
- 连接在通信链路上的设备(主机或路由器)在接收MAC帧时，其根据是MAC帧首部的硬件地址。
- 在数据链路层看不见隐藏在MAC帧的数据中的IP地址。
- 只有在剥去MAC帧的首部和尾部后，把MAC帧的数据部分上交给网络层后，网络层才能在IP数据报的首部中找到源IP地址和目的IP地址。

#### **2.3 具体例子**

- **例子：三个局域网用两个路由器R1和R2互连起来，现在主机H1要和主机H2通信。**
- **主机H1的IP地址是IP1，硬件地址是HA1。**
- **主机H2的IP地址是IP2，硬件地址是HA2。**
- **路由器R1由于同时连接到两个局域网上，因此它有两个硬件地址HA3和HA4。**
- **路由器R2由于同时连接到两个局域网上，因此它有两个硬件地址HA5和HA6**



## 数据链路层

- **物理层和数据链路层**的本质作用都是用来构建网络通信、访问通道，但它们所**建立的通信通道是不一样的**。首先要说明的一点是，在物理层上构建的是**物理链路**，在数据链路层上构建的是**逻辑链路或者数据链路**。
- **物理链路**是指在物理层设备（包括传输介质、物理接口和收发器等）和相应物理层通信规程作用下形成的物理线路，是永久存在的，且是不可删除的（除非物理拆除）；**逻辑链路**则是通信双方在需要进行数据通信时，在数据链路层设备和相应的通信规程作用下建立的逻辑链路，可以是永远存在的（如局域网中的以太网链路），也可以不是永久存在的（如广域网中的链路），是否永久存在要视具体的数据链路层服务类型而定。

**主要功能：用于两个设备(同一种数据链路节点)之间进行信息传递。**

**网络层和数据链路层对比：** [网络层](https://so.csdn.net/so/search?q=网络层&spm=1001.2101.3001.7020)是进行地址管理和路由选择的，它是为数据报的转发找出一条路来，而数据链路层解决的是两个结点直接的数据交换，数接近于物理层的概念。

20 世纪60 年代以来，计算机网络得到了飞速发展。各大厂商和标准组织为了在数据通信网
络领域占据主导地位，纷纷推出了各自的网络架构体系和标准，如IBM 公司的SNA 协议，
Novell 公司的IPX/SPX 协议，以及广泛流行的OSI 参考模型和TCP/IP协议。同时，各大厂
商根据这些协议生产出了不同的硬件和软件。标准组织和厂商的共同努力促进了网络技术
的快速发展和网络设备种类的迅速增长。
网络通信中， " 协议" 和" 标准" 这两个词汇常常可以混用。同时， 协议或标准本身又常
常具有层次的特点。一般地， 关注于逻辑数据关系的协议通常被称为上层协议， 而关注于
物理数据流的协议通常被称为底层协议。IEEE 802 就是一套用来管理物理数据流在局域网
中传输的标准， 包括在局域网中传输物理数据的802.3 以太网标准。除以太外， 还有一些用
来管理物理数据流在广域网中传输的标准， 如PPP （ Point-to- Poi nt Protocol ） ， 高级数
据钅连路控制HDLC （ High-LeveI Data Link ControI ） 。

了解以太网：

“以太网” 不是一种具体的网络, 而是一种技术标准; 它既包含了数据链路层的内容, 也包含了一些物理层的内容. 例如: 规定了网络拓扑结构, 访问控制方式, 传输速率等
以太网中的网线必须使用双绞线，传输速率有10M, 100M, 1000M等
以太网是当前应用广泛的局域网技术; 和以太网并列的还有令牌环网, 无线LAN等

**以太网MAC帧格式：**

**数据链路层实现的三大功能分别为：**

**(1) 封装成帧**

封装成帧就是在一段数据前后**分别加入首部和尾部**，构成了一个帧。



接收端在收到物理层上交的比特流后。能依据首部跟尾部的标记。从收到的比特流识别帧的開始和结束。

此外，首部跟尾部还包含很多必要的控制信息。

在发送帧时，是从帧首部開始发送。各种数据链路层协议都要对帧首尾部格式有明白的规定。每一种协议都限定了帧的数据部分长度上限----**最大传输单元MTU。**

为了向网络层提供服务，数据链路层必须使用物理层提供的服务。而物理层我们知道，它是以比特流进行传输的，这种比特流并不保证在数据传输过程中没有错误，接收到的位数量可能少于、等于或者多于发送的位数量。而且它们还可能有不同的值，这时数据链路层为了能实现数据有效的差错控制，就采用了一种“帧”的数据块进行传输。而要采帧格式传输，就必须有相应的帧同步技术，这就是数据链路层的“成帧”（也称为“帧同步”）功能。

封装成帧(framing)：就是在一段数据的前后分别添加首部和尾部，这样就构成了一个帧。接收端在收到物理层上交的比特流后，就能根据首部和尾部的标记，从收到的比特流中识别帧的开始和结束。
分组交换的一个重要概念：就是所有在因特网上传送的数据都是以分组(即IP数据报)为传送单位。
网络层的IP数据报传送到数据链路层就成为帧的数据部分。在帧的数据部分的前面和后面分别添加上首部和尾部，就构成了一个完整的帧。
帧长等于数据部分长度加上帧首部和帧尾部的长度，而首部和尾部的一个重要作用就是进行帧定界(即确定帧的界限)。
首部和尾部还包含许多必要的控制信息，在发送帧时，是从帧首部开始发送。
各种数据链路层协议都要对帧首部和帧尾部的格式有明确的规定。
为了提高帧的传输效率，应当使帧的数据部分长度尽可能大于首部和尾部的长度。但是，每一种链路层协议都规定了帧的数据部分的长度上限——最大传送单元MTU(Maximum Transfer Unit)



当数据是由可打印的ASCII码组成的文本文件时，帧定界可以使用特殊的帧定界符。
控制字符SOH(Start Of Header)放在一帧的最前面，表示帧的首部开始。另一个控制字符EOT(End Of Transmission)表示帧的结束。他们的十六进制编码分别是01(二进制是00000001)和04(二进制是00000100)。





采用帧传输方式的好处是，在发现有数据传送错误时，只需将有差错的帧再次传送，而不需要将全部数据的比特流进行重传，这就在传送效率上将大大提高。但随后很快又恢复正常，于是重新从头开始发送刚才未发送完的帧。由于使用了帧定界符，在接收端就知道前面收到的数据时个不完整的帧(只有首部SOH，没有传输结束符EOT)，必须丢弃。而后面收到的数据有明显的帧定界符(SOH和EOT)，因此这是一个完整的帧，应当收下。
但同时也带来了两方面的问题：（1）如何识别帧的开始与结束；（2）在夹杂着重传的数据帧中，接收方在接收到重传的数据帧时是识别成新的数据帧，还是识别成已传帧的重传帧呢？这就要靠数据链路层的各种“帧同步”技术来识别了。“帧同步”技术既可使接收方能从以上并不是完全有序的比特流中准确地区分出每一帧的开始和结束，同时还可识别重传帧。

附：最大传输单元MTU**(笔者腾讯一面亲历)**

**一个UDP报文能传输的最大数据为多大？**

以太网的数据链路层规定了最大传输单元MTU=1500（字节），那么实际上一个IP数据报最长也就是1500 字节，而IP数据报又是由UDP报文或TCP流封装得到的，那么一个UDP报文最大长度为1500-20=1480.20为IP数 据报的首部长度。

而在运输层。UDP也有自己的首部（8字节），所以在应用层一个UDP报文能传递的最大数据 为1500-20-8=1472（字节）

**(2) 透明传输
**

在上面提到了在数据链路层实现透明传输和封装成帧时，使用到了转义字符。在假设没有使用转义字符的前提下我们来分析一下存在的问题：

由于帧的开始和结束的标记是使用专门指明的控制字符，因此，所传输的数据中的任何8比特的组合一定不允许和用作帧定界的控制字符的比特编码一样，否则就会出现帧定界的错误。
当传送的帧使用文本文件组成的帧时(文本文件中的字符都是从键盘上输入的)，其数据部分显然不会出现像SOH或EOT这样的帧定界控制字符。可见不管从键盘上输入什么字符都可以放在这样的帧中传输过去，因此这样的传输就是透明传输。
问题：当数据部分是非ASCII码的文本文件时(如二进制代码的计算机程序或图像等)，情况就不同了，如果数据中的某个字符的二进制代码恰好和SOH或EOT这种控制字符一样，数据链路层就会错误地找到帧的边界，把部分帧收下(误认为是完整的帧)，而把剩下的那部分数据丢弃(这部分找不到帧定界控制字符SOH)。这样的帧的传输显然就不是透明传输。

问题分析：为了解决透明传输的问题，就必须设法使数据中可能出现的控制字符“SOH”和“EOT”在接收端不被解析为控制字符。
解决方法：发送端的数据链路层在数据中出现控制字符”SOH”和”EOT”的前面插入一个转义字符”ESC”(其十六进制编码是1B)。而在接收端的数据链路层在将数据送往网络层之前删除这个插入的转义字符。这种方法称为字节填充(byte stuffing)或字符填充(character stuffing)。如果转义字符也出现在数据当中，那么解决方法仍然是在转义字符的前面插入一个转义字符。因此，当接收端收到连续的两个转义字符时，就删除其中前面的一个。



**解决透明传输的方法：**

**1、发送端的数据链路层在数据中出现控制字符“SOH”或“EOT”的前面插入一个转义字符“ESC”(其十六进制编码是 1B)。**

**2、字节填充或字符填充——接收端的数据链路层在将数据送往网络层之前删除插入的转义字符。**

**3、假设转义字符也出现数据其中。那么应在转义字符前面插入一个转义字符。当接收端收到连续的两个转义字符时。就删除其中前面的一个。** 

**(3) 差错控制**

在传输过程中可能会产生比特差错：1 可能会变成 0 而 0 也可能变成 1。
为了保证数据传输的可靠性，在计算机网络数据传输时。必须採用各种差错检測措施。 

传输差错：可分为两大类，一类就是最基本的比特差错，另一类就是收到的帧并没有出现比特错误，但却出现了帧丢失、帧重复或帧失序。

比特差错：就是比特在传输过程中可能会产生差错，即1可能会变成0，0可能会变成1。比特差错是传输差错中的一种。
三个帧：[#1]-[#2]-[#3]，假定在接收端收到的却有可能出现的情况：
(1)帧丢失：收到[#1]-[#3]（丢失了[#2]）。
(2)帧重复：收到[#1]-[#2]-[#2]-[#3]（收到两个[#2]）。
(3)帧失序：收到[#1]-[#3]-[#2]（后面发的帧反而先到达了接收端，这与一般的数据链路层传输概念不一样）。
误码率BER(Bit Error Rate)：就是在一段时间内，传输错误的比特占所传输比特总数的比率。例如，误码率为10 ^ (-10)时，表示平均每传送10^10个比特就会出现一个比特的差错。误码率与信噪比有很大的关系，如果提高信噪比，就可以使误码率减小。
问题：实际的通信链路并非理想的，它不可能使误码率下降到零。
问题分析：为了保证数据传输的可靠性，在计算机网络传输数据时，必须采用各种检测措施。
解决方法：目前在数据链路层广泛使用了循环冗余检验CRC(Cyclic Redundancy Check)的检测技术。
注：在数据链路层使用CRC检验，能够实现无比特差错的传输，但这还不是可靠传输。

补充：
OSI的观点是必须把数据链路层做成是可靠传输的。因此在CRC检测基础上，增加了帧编号、确认和重传机制。收到正确的帧就要向发送端发送确认。发送端在一定的期限内若没有收到对方的确认，就认为出现了差错，因而就进行重传，直到收到对方的确认为止。
这种方法在历史上曾经起到很好的作用。但现在的通信线路的质量已经大大提高了，由通信链路质量不好引起差错的概率已经大大降低。

因特网广泛使用的数据链路层协议都不适用确认和重传机制，即不要求数据链路层向上层提供可靠传输的服务(因为这要付出的代价太高，不合算)。如果在数据链路层传输数据时除了差错并且需要进行改正，那么改正差错的任务就由上层协议(如，运输层TCP协议)来完成。实验证明，这样可以提高通信效率。


**CRC循环冗余检測**

在数据链路层传送的帧中，广泛使用了循环冗余检验 CRC 的检错技术。




**发送端运行的操作：**

在发送端，先把数据划分为组。假定每组 k 个比特。


如果待传送的一组数据 M = 101001（如今 k = 6）。

我们在 M 的后面再加入供差错检測用的 **n 位冗余码**一起发送。  

冗余码计算实例：

如今 k = 6, M = 101001。
设 n = 3, 除数 P = 1101，**（除数P是我们自己约定的。n的取值是 P的位数减1）**
被除数是 (2^n)M = 101001000。

**(对M从后開始补0，一共补n位)**
模 2 运算的结果是：商 Q = 110101，（计算结果见下图）
      余数 R = 001。
把**余数 R 作为冗余码**加入在数据 M 的后面发送出去。发送的数据是：101001001。共 (k + n) 位。

MAC寻址
这是数据链路层中的MAC子层主要功能。这里所说的“寻址”与“IP地址寻址”是完全不一样的，因为此处所寻找地址是计算机网卡的MAC地址，也称“物理地址”、“硬件地址”，而不是IP地址。在以太网中，采用媒体访问控制（Media Access Control, MAC）地址进行寻址，MAC地址被烧入每个以太网网卡中。这在多点连接的情况下非常必需，因为在这种多点连接的网络通信中，必须保证每一帧都能准确地送到正确的地址，接收方也应当知道发送方是哪一个站。

链路层向网络层提供的服务
数据链路层的设计目标就是为网络层提供各种需要的服务。实际的服务随系统的不同而不同，但是一般情况下，数据链路层会向网络层提供以下三种类型的服务：

1. 无确认的无连接服务
“无确认的无连接服务”是指源计算机向目标计算机发送独立的帧，目标计算机并不对这些帧进行确认。这种服务，事先无需建立逻辑连接，事后也不用解释逻辑连接。正因如此，如果由于线路上的原因造成某一帧的数据丢失，则数据链路层并不会检测到这样的丢失帧，也不会恢复这些帧。出现这种情况的后果是可想而知的，当然在错误率很低，或者对数据的完整性要求不高的情况下（如话音数据），这样的服务还是非常有用的，因为这样简单的错误可以交给OSI上面的各层来恢复。如大多数局域网在数据链路层所采用的服务也是无确认的无连接服务。

2. 有确认的无连接服务
为了解决以上“无确认的无连接服务”的不足，提高数据传输的可靠性，引入了“有确认的无连接服务”。在这种连接服务中，源主机数据链路层必须对每个发送的数据帧进行编号，目的主机数据链路层也必须对每个接收的数据帧进行确认。如果源主机数据链路层在规定的时间内未接收到所发送的数据帧的确认，那么它需要重发该帧。 这样发送方知道每一帧是否正确地到达对方。这类服务主要用于不可靠信道，如无线通信系统。它与下面将要介绍的“有确认的面向连接服务”的不同之处在于它不需要在帧传输之前建立数据链路，也不要在在帧传输结束后释放数据链路。

3. 有确认的面向连接服务
大多数数据链路层都采用向网络层提供面向连接确认服务。利用这种服务，源计算机和目标计算机在传输数据之前需要先建立一个连接，该连接上发送的每一帧也都被编号，数据链路层保证每一帧都会被接收到。而且它还保证每一帧只被按正常顺序接收一次。这也正是面向连接服务与前面介绍的“有确认无连接服务”的区别，在无连接有确认的服务中，在没有检测到确认时，系统会认为对方没收到，于是会重发数据，而由于是无连接的，所以这样的数据可能会复发多次，对方也可能接收多次，造成数据错误。这种服务类型存在3个阶段，即：数据链路建立、数据传输、数据链路释放阶段。每个被传输的帧都被编号，以确保帧传输的内容与顺序的正确性。大多数广域网的通信子网的数据链路层采用面向连接确认服务。

以太网采用无连接的工作方式，读发送的数据帧不进行编号，也不要求对方发回确认。目的站收到有差错的帧就把他丢弃，不采取其他行为。

其他知识点
局域网的优点：具有广播功能，从一个站点可以很方便的访问全网；便于系统的扩展和逐渐演变；提高了系统的可靠性、可用性和生存性。
以太网采用的协议是具有冲突检测的载波监听多点接入CMSA/CD。协议的要点是：发送前先监听，便发送边监听，一旦发现总线上出现了碰撞，就立即停止发送。然后按照退避算法等待一段随机时间后再次发送。因此，每一个站在自己发送数据之后的一小段时间内，存在着遭遇碰撞的可能性。以太网上各站点都平等的争用以太网信道。

由上图可以看出帧协议类型字段有三种值,分别对应IP、ARP、RARP(现在已经弃用)
源地址和目的地址是指网卡的硬件地址(也叫MAC地址), 长度是48位,是在网卡出厂时固化的。
关于MAC地址：

MAC地址是用来识别数据链路层中相连的结点
MAC地址长度为48位, 6个字节，一般用16进制数字加上冒号的形式来表示(例如: 08:00:27:03:fb:19)
MAC地址在网卡出厂时就确定了, 不能修改。 MAC地址通常是唯一的(虚拟机中的MAC地址不是真实的MAC地址可 能会冲突，也有些网卡支持用户配置MAC地址)
为什么存在MAC地址还需要IP地址去标识互联网中的一台主机呢？

在数据链路层，存在多种异构的网络，比如以太网、令牌环网等，也就是数据链路层存在多种MTU，既多种不同的传输信道，如果只有MAC地址，在不同的网络之间是每有办法传输的，只能在MAC地址上封装一次抽象的IP地址来封装底层各种不同的网络。

MAC地址和IP地址的对比：

一个数据报中的源IP地址和目的IP地址是为了标识这个数据的起点和终点
源MAC地址和目的MAC地址是为了标识上一站的地址和下一站的地址
在一个数据报的传输过程中，IP一直不变，而MAC地址是一直在变的
关于MTU(最大传输单元)： MTU相当于在发寄快递的时候对包裹的限制，这个限制是不同的链路层对应的物理层的限制。

MAC帧中的数据长度规定为46-1500字节,ARP(地址解析协议)数据包的长度不够46字节要在后面补填充位，如果大于1500字节，必须要求网络层进行分片。
最大值1500称为以太网的最大传输单元(MTU)不同的网络类型有不同的MTU
如果一个数据包从以太网路由到拨号链路上，数据包长度大于拨号链路的MTU,则需要对数据包进行分片。
MTU对IP协议的影响： 由于链路层存在MTU的限制，导致网络层的报文如果超过1500字节，就必须要对齐进行分片发送。

将较大的IP包分成多个小包, 并给每个小包打上标签，每个小包IP协议头的 16位标识(id) 都是相同的，这样在重组的时候就知道这个小包来自于哪个报文。
每个小包的IP协议头的3位标志字段中, 第2位MF置为0, 表示允许分片, 第3位DF来表示结束标记(当前是否是后一个小包, 是的话置为1, 否则置为0)。
到达对端时再将这些小包按顺序重组, 拼装到一起返回给传输层。一旦这些小包中任意一个小包丢失，接收端的重组就会失败，但是IP层不会负责重新传输数据。
MTU对UDP协议的影响：

只要UDP报文中携带的数据超过过1472(1500 - 20(IP首部) - 8(UDP首部))，那么就会在网络层分成多个IP数据报。
这些IP数据报有任意一个丢失，都会引起接收端网络层重组失败。那么这就意味着，如果UDP数据报在网络层被分片，整个数据被丢失的概率就大大增加。
MTU对TCP协议的影响：

TCP报文的长度不能无限大，依然要受制于MTU， TCP的单个数据报的大消息长度称为MSS(Max Segment Size)。
TCP在建立连接时，首先会和对方协商MSS的大小。理想的情况下，MSS的值正好是在IP不会被分片处理的大长度(这个长度仍然是受制于数据链路层的·MTU)
双方在发送SYN的时候会在TCP头部写入自己能支持的MSS值。然后双方得知对方的MSS值之后选择较小的作为最终的MSS。MSS的值就是在TCP首部的40字节变长选项中(kind=2)。
MSS = MTU - TCP首部 - IP首部，既TCP报文的数据长度
在Linux系统中可以使用ifconfig命令查看MAC、IP和MTU：

ARP协议： ARP是介于链路层到网络层之间的协议，它的作用是为了解析IP地址到MAC地址的映射，在网络层一个数据报拿到了下一条的IP地址，但是数据报是要经过底层的链路层传输的，所以要通过ARP协议得到下一条的MAC地址才能传输数据报。数据包首先是被网卡接收到再去处理上层协议的,如果接收到的数据包的硬件地址与本机不符,则直接丢弃。

ARP协议工作原理：

源主机发出ARP请求，询问“IP地址是192.168.0.1的主机的硬件地址是多少”，并将这个请求广播到本地网段(以太网帧首部的硬件地址填FF:FF:FF:FF:FF:FF表示广播)
目的主机接收到广播的ARP请求，发现其中的IP地址与本机相符，则发送一个ARP应答数据包给源主机，将自己的硬件地址填写在应答包中。
每台主机都维护一个ARP缓存表可以用arp -a命令查看。缓存表中的表项有过期时间(一般为20分钟)如果20分钟内没有再次使用某个表项则该表项失效，下次还要发ARP请求来获得目的主机的硬件地址。

**ARP数据报的格式**

- 源MAC地址、目的MAC地址在以太网首部和ARP请求中各出现一次,对于链路层为以太网的情况 是多余的,但如果链路层是其它类型的网络则有可能是必要的。
- 硬件类型指链路层网络类型，1表示以太网
- 协议类型指要转换的地址类型，0x0800为IP地址
- 硬件地址长度对于以太网地址为6字节; 协议地址长度对于IP地址为4字节
- op字段为1表示ARP请求，op字段为2表示ARP应答
  

### PPP协议的工作状态

PPP 协议**工作流程**
 1、用户拨号接入 ISP 后，就建立了一条从 `用户pc` 到 `ISP` 的**物理连接**
 2、用户pc 向 ISP 发送一系列的 `链路控制协议 LCP分组（封装成多个 PPP 帧）`，这些 `分组及其响应` 选择了将要使用的一些 PPP 参数，建立 **LCP 连接**
 3、LCP连接鉴别成功后，进行NCP配置协商，网络控制协议 NCP 给新接入的用户pc 分配一个临时IP，建立 **NCP链路**，可以开始通信
 4、用户通信完毕，NCP 释放 `网络层连接`，收回 临时IP。然后 LCP 释放 `数据链路层连接`。最后释放 `物理层连接`。

·局域网具有如下主要优点：
具有广播功能，从一个站点可很方便地访问全网。局域网上的主机
可共享连接在局域网上的各种硬件和软件资源；
便于系统的扩展和逐渐地演变，各设备的位置可灵活调整和改变；
提高了系统的可靠性、可用性和残存性。
局域网最主要的特点是：
·网络为一个单位所拥有；

地理范围和站点数目均有限。

## **①、局域网的数据链路层**

- 局域网最主要的**特点**是：1、网络为一个单位所拥有 2、地理范围和数量有限

局域网的主要特点：

1. 具有**广播功能**，局域网上的主机可**共享连接在局域网**上的各种硬件和软件资源**。**
2. 便于系统的**扩展**和逐渐地**演变**，各设备的位置可灵活调整和改变 。
3. 提高了系统的**可靠性**、**可用性**和**残存**
4. 

**

**1、信道共享**：多个设备在共享信道同时发送数据，会造成彼此干扰，导致发送失败。共享信道着重考虑的问题是如何使得一个用户合理而方便地共享通信资源。

- **静态划分信道** 频分复用 时分复用 波分复用 码分复用
- **动态媒体接入控制** 随机接入 受控接入（多点线路探询（polling），轮询）



**2、以太网地两个标准**：

1. **DIX Ethernet V2 （DEC、Intel、Xerox ）是世界上第一个局域网产品（以太网）的规约。**
2. **IEEE 802.3 是第一个 IEEE 的以太网标准,**两个标准只有很小地差别，因此可以将802.3简称为“以太网”**。**

**3、数据链路层地两个子层**

为了使数据链路层能更好地适应多种局域网标准，IEEE 802 委员会就将局域网的数据链路层拆成**两个子层**：**1.逻辑链路控制 LLC (Logical Link Control)子层；2.媒体接入控制 MAC (Medium Access Control)子层。**

**4、适配器的作用**

网络接口板又称为**通信适配器 (adapter)** 或**网络接口卡 NIC (Network Interface Card)**，或“**网卡**”**。**

- 进行串行/并行转换。
- 对数据进行缓存。
- 在计算机的操作系统安装设备驱动程序。
- 实现以太网协议。



## ②、CSMA/CD协议

最初的以太网是将许多计算机都连接到一根总线上。易于实现**广播通信**。当初认为这样的连接方法既简单又可靠，因为总线上没有有源器件。总线也有**缺点**，若多台计算机或多个站点同时发送，会发送**碰撞或冲突**。



**1、以太网特点**

- 不必先建立连接就可以直接发送数据
- 对发送的数据帧不进行编号，也不要求对方发回确认
- 以太网提供的服务是**不可靠的交付**，即尽最大努力的交付，**差错的纠正由高层**决定。
- 高层发现丢失了一些数据进行重传，但以太网**并不知道这是一个重传的帧**。
- 以太网发送的数据都使用**曼彻斯特**编码**。**

**2、CSMA/CD含义：载波监听多点接入/碰撞检测（carrier sense multiple access with collision detection）**

- **多点接入** 表示许多计算机以多点接入的方式连接在一根总线上。
- **载波监听** 每一个站在发送数据之前先要检测以下总线上是否有其他计算机在发送数据，如果有，则暂时不要发送数据，以免发送碰撞。



电路交换重要特点：**在通话的全部时间内，通话的两个用户**始终占用端到端的通信资源**。容易造成资源浪费。

而下文要讲的**分组交换（Packet Switching）**在传送数据之前**不必先占用一条端到端的链路通信资源**。分组在哪段链路上传送时，才占用这段链路的通信资源。

## 排序

## **1. 冒泡排序**

冒泡排序是一种简单的排序算法。它重复地走访过要排序的数列，一次比较两个元素，如果它们的顺序错误就把它们交换过来。走访数列的工作是重复地进行直到没有再需要交换，也就是说该数列已经排序完成。这个算法的名字由来是因为越小的元素会经由交换慢慢“浮”到数列的顶端。

## **算法描述**

1. 比较相邻的元素。如果第一个比第二个大，就交换它们两个；
2. 对每一对相邻元素作同样的工作，从开始第一对到结尾的最后一对，这样在最后的元素应该会是最大的数；
3. 针对所有的元素重复以上的步骤，除了最后一个；
4. 重复步骤1~3，直到排序完成。



```java
public static void bubbleSort(int[] arr) {
    int temp = 0;
    for (int i = arr.length - 1; i > 0; i--) { // 每次需要排序的长度
        for (int j = 0; j < i; j++) { // 从第一个元素到第i个元素
            if (arr[j] > arr[j + 1]) {
                temp = arr[j];
                arr[j] = arr[j + 1];
                arr[j + 1] = temp;
            }
        }//loop j
    }//loop i
}// method bubbleSort
```

在数据完全有序的时候展现出最优时间复杂度，为O(n)。其他情况下，几乎总是O( n2 )。因此，算法在数据基本有序的情况下，性能最好。
要使算法在最佳情况下有O(n)复杂度，需要做一些改进，增加一个`swap`的标志，当前一轮没有进行交换时，说明数组已经有序，没有必要再进行下一轮的循环了，直接退出。

```java
public static void bubbleSort(int[] arr) {
    int temp = 0;
    boolean swap;
    for (int i = arr.length - 1; i > 0; i--) { // 每次需要排序的长度
        swap=false;
        for (int j = 0; j < i; j++) { // 从第一个元素到第i个元素
            if (arr[j] > arr[j + 1]) {
                temp = arr[j];
                arr[j] = arr[j + 1];
                arr[j + 1] = temp;
                swap=true;
            }
        }//loop j
        if (swap==false){
            break;
        }
    }//loop i
}// method bubbleSort
```

## 路由选择协议——内部网关协议RIP

**RIP简述**

- RIP是一种分布式的**基于距离向量**的路由选择协议，其最大优点是简单。
- RIP要求网络中的每一个路由器都要维护从它自己到其他每一个目的网络的距离（也称跳数）记录（距离向量），具体定义的距离如下：
   从一路由器到直接连接的网络的距离定义为1，到非直接连接的网络的距离定义为所经过的路由器书+1.


**RIP协议特点**

1. 仅和相邻的路由器交换信息。
2. 路由器交换的信息是当前本路由器所知道的全部信息，即自己现在的路由表。
3. 按固定的时间间隔交换路由信息。

以太网最早是指由DEC（Digital Equipment Corporation）、Intel和Xerox组成的DIX（DEC-Intel-Xerox）联盟开发并于1982年发布的标准。经过长期的发展，以太网已成为应用最为广泛的局域网，包括标准以太网（10 Mbit/s）、快速以太网（100 Mbit/s）、千兆以太网（1000 Mbit/s）和万兆以太网（10 Gbit/s）等。IEEE 802.3规范则是基于以太网的标准制定的，并与以太网标准相互兼容。

在TCP/IP中，以太网的IP数据报文的封装格式由RFC894定义，IEEE802.3网络的IP数据报文封装由RFC1042定义。当今最常使用的封装格式是RFC894定义的格式，通常称为Ethernet_II或者Ethernet DIX。

**01 以太网基础知识**

**1.1 以太网的网络层次**

以太网采用无源的介质，按广播方式传播信息。它规定了物理层和数据链路层协议，规定了物理层和数据链路层的接口以及数据链路层与更高层的接口。

**物理层**

物理层规定了以太网的基本物理属性，如数据编码、时标、电频等。

物理层位于OSI参考模型的最底层，它直接面向实际承担数据传输的物理媒体（即通信通道），物理层的传输单位为比特（bit），即一个二进制位（“0”或“1”）。实际的比特传输必须依赖于传输设备和物理媒体，但是，物理层不是指具体的物理设备，也不是指信号传输的物理媒体，而是指在物理媒体之上为上一层（数据链路层）提供一个传输原始比特流的物理连接。

**数据链路层**

数据链路层是OSI参考模型中的第二层，介于物理层和网络层之间。数据链路层在物理层提供的服务的基础上向网络层提供服务，其最基本的服务是将源设备网络层转发过来的数据可靠地传输到相邻节点的目的设备网络层。

由于以太网的物理层和数据链路层是相关的，针对物理层的不同工作模式，需要提供特定的数据链路层来访问。这给设计和应用带来了一些不便。

为此，一些组织和厂家提出把数据链路层再进行分层，分为媒体接入控制子层（MAC）和逻辑链路控制子层（LLC）。这样不同的物理层对应不同的MAC子层，LLC子层则可以完全独立。如图1-1所示。



以太网的信道被占用的情况
假设 r 是以太网单程端到端传播时延。则争用期长度为 2r ，即端到端传播时
延的两倍。这里假定检测到冲突后不发送干扰信号。

一个站在发送帧时出现了冲突。经过一个争用期 2 r后，可能又会冲突。这样
经过若干个争用期后，一个站发送成功了。假定发送帧需要的时间是 T 0 。

设帧长为 L (bit)，数据发送速率为 C (bit/s)，则帧的发送时间为 T 0 = L/C (s)。

# 以太网中的参数 a

> 要**提高以太网的信道利用率**，**就必须减小 r与 T 0 之比。**

## 远程控制与黑客入侵

### 远程控制技术

#### 概论

远程控制是指网络管理人员在异地通过计算机网络异地拨号或双方都接入因特网（Internet）等手段，通过网络空间中的一台计算机（主控端Remote/客户端）远距离去控制另一台计算机（被控端Host/服务器端）的技术。

主控端计算机只是将键盘和鼠标的指令传送给远程计算机，同时将被控端计算机的屏幕画面通过通信线路回传过来。

#### 原理

网络空间远程控制技术分为两个部分来实现：

（1）客户端程序安装到主控端计算机；

（2）服务端程序安装到被控端计算机。

网络远程控制技术即利用一台电脑远距离控制另一台电脑，在这个控制过程中，将**TCP/IP协议网络数据通信**作为基础，在控制计算机与被控计算机内运行，确保网络通讯等各项功能可以顺利实现。现在IP协议中主要存在UDP与TCP两种通讯传输协议，且UDP协议采用数据拆分后以数据报传输方式，并未对达到数据有专门要求；TCP  协议则是对待传输数据进行分割、打包处理后，以数据流形式进行传输，可以选择在控制与被控制两台计算机间建立虚电路，提高数据传输的准确性、连续性与双向性。两种协议对比可知，UDP协议运行可靠性较低，两台计算机间未建立有效的连接，只有当客户端与服务端选择应用相同程序时，才可以进行数据的传输。而TCP 协议因两者间具有稳定的连接关系，具有更大的灵活性。

它控制的过程一般是先在主控端计算机上执行客户端程序，像一个普通的客户一样向被控端计算机中的服务器端程序发出信号，建立一个特殊的远程服务，然后通过这个远程服务，使用各种远程控制功能发送远程控制命令，控制被控端计算机中的各种应用程序运行，称这种远程控制方式为基于远程服务的远程控制技术

## 二、网络远程控制技术实现

   

（1）远程唤醒控制技术

想要对指定的远程计算机进行网络唤醒时，需要在本地计算机中，将一个MAGIC PACKET 标准唤醒数据包作为基础进行发送。数据包内含有所有用于唤醒远程计算机的物理地址，因为计算机电源专用线路来为网络控制芯片进行供电，即便待环境计算机为关机状态，也可以实现对计算机网络内数据包进行良好的接收与控制。由控制芯片来对数据包内的所有MAC地址进行检查确认，然后通过专用线路将电源信号开启，向计算机主板发送开机启动命令，达到唤醒目的。

（2）远程屏幕监控技术

远程屏幕监控技术的实现，需要将TCP协议作为基础，操作控制端向被控制端发送截屏命令。待被控制端计算机接受命令后，便可自动完成自己屏幕的截屏操作，并将截屏图片发送给控制端计算机，且在接受后显示在控制端计算机上。通过钩子程序，被控制端接收的鼠标点击事件或键盘事件加到消息队列中，以实现对被控制端的点击和按键操作。

（3）远程关机技术

远程关机技术的实现，需要通过TCP/IP  网络协议内C/S结构实现，完成计算机服务器端的软件安装，并通过控制方端口向受控方端口发送数据包。如果需要对其他计算机进行控制，则需要另外安装客户端软件。此种网络通信功能的实现，均通过TCP/IP 网络协议实现网络连接。待将客户端计算机关闭后，由客户端计算机发送命令，调用系统关机函数，便可以实现远程计算机的关机操作。

   

### 网络远程控制服务器程序实现过程

服务器程序需要先设置好LocalPort 属性，作为侦听端口，且值为任何一个其他TCP/IP 应用程序未用过的整数即可。利用Listen  方法进入侦听状态，等待远程端客户机程序连接要求。当客户机程序发出连接请求后，程序将会产生一个ConnectionRequest事件，并得到一个参数requestID。服务器程序通过Accept 方法接受客户机程序requestID 请求，然后通过SendData 方法发送数据，且此种方法需要选择上一步获得的requestID  为参数。待服务器程序成功接收到程序后，产生DtataArrival 事件。而程序接收到的所有数据字节数均被包含在参数BytesTotal  内。如果接收到Close 事件，则选择应用Close 方法将TCP/IP 连接关闭。

   

### 网络远程控制客户机程序实现过程

客户机程序需要先设置Remotehose 属性，确定运行服务程序主机名，并指定服务器程序侦听端口。选择Connect  方法，向服务器提出连接请求。服务器接受到客户机请求后，程序产生Connect 事件，便可以通过应用SendDaya  方法发送数据。待客户机程序接收到数据后，产生DtataArrival 事件，参数BytesTotal  包含接收到的数据字节数。如果接收到的为Close 事件，则可以用Close 方法关闭。

  

## 三、网络远程控制结构

计算机网络远程控制主要包括远程控制体系结构与通。信系协其网络结构以“分”与“和”网络实体，并包括主控 网络与受控网络两个体系结构从功能角度分析，远程控制系统主要指主拴网络系统、信息及数据的传输通道以及受控网络系统，三者相互协作从而实现远程控制的目标。

   

### 网络远程控制主控网络

关于主控网络，首先需提到网络系统控制过程的基本理论，即网络控制论。其主要研究内容为信息、状态以  及网络拓扑结构，通常这种理论是向建主控网络的参考依据。而主控网络的功能方面，主要在于对控制命令及参数的输入，并将被控设备的操作  以及反馈信息显示出来。另外，从网络主控的基本框架角度，又分为集中、分散和递阶三种控制结构，每个控制结构都存在二定的优点及不足。二其中集中控制结构在结构与控制方面比较简单，使管理与建网工作比较容易，而且延迟时间小，减少传输  过程中的误差。但是安装的工作量较大，成本较高，不利于实现资源共享。分散控制结构的优势在于其可靠性较高，即使控制器出现故障，网络系统也不会全局瘫痪。所以在系统规模元法集中控制、通信较为方便或者用户要求使用分散控制结构的场合中，可采用分散控制结构，然而分散控制结构也存在一定的缺陷。如对网络系统状态无法控制与观测，递阶控制结构，将集中与分散控制结构相结合，既能实现局部控制，又可对全局实现协调控制。

   

### 网络远程控制受控网络体系

受控网络体系主要以网络控制论为基础，通过软件或硬件使控制机制得以执行，提供一定的控制服务。一般受控网络系统可理解为一个数据资源，也可以是以计算机为中心，将现场控制与管理及数据采集结合在一起形成的控制系统。在结构方面，主要包括网络受控中心、采集节点用户界面以及中间控制节点。设计过程中，应遵循一定的原则，即进行安全检测安全防护和应急恢复的规划体现的是整体性的原则，划分受控网络安全级别与层次体现的是等级性原则。受控网络中可变因素的引进体现的是动态化的原则，对权限的限制体现了最小化原则，只有保证设计原则的应用，才能使网络系统的安全性与控制性得到保障。

   

### 网络远程控制通信协议

（1）TCP协议

TCP  协议在现阶段应用中，已成为网络协议的主要标准，具布一定的安全性与稳定性。但占用资源过多、效率较低，其主要特征包括三种：第一，面向连接TCP  协议必须保证两台计算机之间连接进程的建立，才能实现数据的交换。第二，通过返回通知与序列号的使用，确保传输的可靠性，由于TCP的数据段通常会以多个数据包的形式进行传输，序列号的使用使接收端能够将多个数据包恢复为原来的数据段，在通过返回通知的使用，确认数据己收到。第三，字节流通信的使用，这说明数据会被没有任何信息的字节序列代替。

（2）IP协议

IP 协议又称  因特网协议，用于连接多个包交换网络。从源地址向目的地址传送数据包，而且为使数据包大小满足不同网络的要求，提供重新组装数据大小的功能。在提供服务方面，  IP协议包括四个关键技术：第一，服务类型，服务类型可理解为一个参数集，其中的参数是网络可以提供服务的典型代表，这种服务类型主要由网关使用，用于特定的网络或即将要经过的网络。第二，生存时间：一般发送者会对其进行设置并处理，若数据报没有到达目的地，其生存时间已到上限，便可抛弃此数据报。第三，选项。选项主要包括安全、时间戳和特殊路由，对控制函数起到很重要的作用。第四，报头校验码。它的功能在于确保数据能够正确传输，若校验出错，便将整个数据报抛弃。

现阶段，较为流行的TCP/IP协议代表了TCP与IP两个协议，具体可分为简单网络管理协议、互联网应用协议、支持应用接口以及核心协议。其中简单网络管理协议允许使用如Sum Net Manages或HP Open View等管理工具。对Windows  NT计算机进行远程管理。互联网应用协议则包括FTP、Rep、Finger等协议，使非Microsoft系统计算机上的资源可以为Windows系统用户使用。支持应用接口协议包括远程控制、Windows套接字、Networks以及Net  BIOS。核心协议具体包括UDP协议、ARP协议以及ICMP协议，为计算机互联和网络互联提供了标准协议。由此可见，TCP/IP协议可理解为一组网络协议的集合。

  

## 四、网络远程控制应用

   

### 网络远程控制企业环境应用

在工业迅速发展的背景下，企业想要在市场竞争中占据更大的优势，需要积极引进各项新型技术，提高作业的数字化与信息化水平。例如利用计算机、感应器、检测器等设备将工厂整个生产工艺连接成一个互联的无线控制网络，不仅可以降低生产管理难度，同时还可以减少各类问题的产生，提高生产综合效率。就企业应用现状来看，大部分选择应用局域网络方式，实现机械设备与无线局域网间信息的转化，来提高工业设备联网通信能力。与传统有线网络相比，无线局域网无论是建设成本，还是运行灵活等方面均具有更大的优势。同时，中心监控计算机可以选择应用无线局域网，对设备收集的数据进行有效统计、分析和保存，为管理工作的实施提供数据支持。目前应用最为广泛的为PID 控制方式，以系统误差为依据，通过比例、积分、微分计算出最为合适的生产控制量，对生产总量进行有效调整与控制。

   

### 网络远程控制居民生活应用

日常生活中计算机的应用已经十分广泛，且取得了良好的效果，尤其是在通信交流方面，计算机通讯软件的应用具有明显的优势，例如现在应用的[QQ](https://baike.baidu.com/item/QQ)、[MSN](https://baike.baidu.com/item/MSN/111343)、[微信](https://baike.baidu.com/item/微信/3905974)等，改变了传统通信方式，在实际应用中具有更大的灵活性，资费也更少，更容易被人们所接受。[腾讯QQ](https://baike.baidu.com/item/腾讯QQ)  和微信现在已经成为最为广泛的网络聊天工具，是一种全新的网络通信平台，可以同时支持好友网络聊天、文件与图片传输，以及在线电话、视频电话等多项功能。并且设置了地理定位辅助功能，使得整个聊天软件更具人性化。计算机通信方式的实现，以视频、语音对话代替了传统的通信方式，人们可以根据个人需求，选择最为合适的信息交流方式。MSN  为一种互联网即时消息软件，用户可以通过互联网来实现实时文字交流。并且可以自主选择和决定聊天对象，软件设计时设置了加密程序，能够设置阻止名单来预防不良用户的骚扰，提高软件应用的安全性。

   

### 网络远程控制军事活动应用

基于远程网络控制技术设计的卫星，作为一种高新通信技术，现在已经被广泛地应用到大地测量、石油勘测以及野外营救等领域，尤其是在军事领域的应用，侦察、监控效率更高，在实际应用中具有不可取代的作用。现在卫星多被用于定位，即将卫星定位功能的用户接收机安装在军用飞机、车辆以及舰船上，利用电子地图便可以确定运输工具所在位置，实时掌握其运行状态，便于进行安全监控，且可以提高调度的灵活性。想要充分发挥远程控制技术与计算机通信技术的优点，需要先有效接收终端导航定位信息，待信息处理后，采取一定格式将此类数据，利用无线电接收机传送到指挥中心。由中心接受所有数据后，进行分析和保存，且在专业处理后，在地图中有效定位运输工具以及物资所在实际位置。其中，[GPS](https://baike.baidu.com/item/GPS/214654)技术具有灵活性与精确度高等特点，现在已经被广泛应用到军事行业中。

## 1.网络攻击有哪些层级

1、简单拒绝服务。

2、本地用户获得非授权读权限。

3、本地用户获得非授权写权限。

4、远程用户获得非授权账号信息。

5、远程用户获得特权文件的读权限。

6、远程用户获得特权文件的写权限。

7、远程用户拥有了系统管理员权限。

## 2.常见的网络攻击位置

1、远程攻击

指外部攻击者通过各种手段，从该子网以外的地方向该子网或者该子网内的系统发动攻击。

2、本地攻击

指本单位的内部人员，通过所在的局域网，向本单位的其他系统发动攻击，在本级上进行非法越权访问。

3、伪远程攻击

指内部人员为了掩盖攻击者的身份，从本地获取目标的一些必要信息后，攻击过程从外部远程发起，造成外部入侵的现象。

## 访问控制与防火墙技术

### 访问控制

#### 一 概述

　　访问控制技术，指防止对任何资源进行未授权的访问，从而使计算机系统在合法的范围内使用。意指用户身份及其所归属的某项定义组来限制用户对某些信息项的访问，或限制对某些控制功能的使用的一种技术。
　　访问控制的主要目的是限制访问主体对客体的访问，从而保障数据资源在合法范围内得以有效使用和管理。
　　访问控制（Access Control）指系统对用户身份及其所属的预先定义的策略组限制其使用数据资源能力的手段。
　　访问控制的主要功能包括：保证合法用户访问受权保护的网络资源，防止非法的主体进入受保护的网络资源，或防止合法用户对受保护的网络资源进行非授权的访问。访问控制首先需要对用户身份的合法性进行验证，同时利用控制策略进行选用和管理工作。当用户身份和访问权限验证之后，还需要对越权操作进行监控。
　　因此，访问控制的内容包括认证、控制策略实现和安全审计。
　　（1）认证。包括主体对客体的识别及客体对主体的检验确认。
　　（2）控制策略。通过合理地设定控制规则集合，确保用户对信息资源在授权范围内的合法使用。既要确保授权用户的合理使用，又要防止非法用户侵权进入系统，使重要信息资源泄露。同时对合法用户，也不能越权行使权限以外的功能及访问范围。
　　（3）安全审计。系统可以自动根据用户的访问权限，对计算机网络环境下的有关活动或行为进行系统的、独立的检查验证，并做出相应评价与审计。

##### 1.1 原理简介

　　访问控制的处理过程是获取转发数据包的报文头信息，与访问控制规则进行比较，根据比较的结果对数据包进行转发或者丢弃。
　　访问控制可以是基于 IP 地址、安全域、服务、应用、用户等条件控制流量是否可以通过防火墙。在访问策略中， 策略源定义了报文的来源， 策略源可以是地址（主机、 范围、 子网、MAC 地址）、 区域、 用户对象。 当报文的源地址属于策略源的范围， 则被认为满足策略源约束条件。
　　 策略目的定义了报文的目的地址范围， 可以包括一个或多个主机、 子网、或范围，也可以包括多个区域（或 VLAN） 。 策略服务定义了报文采用的网络协议或特定端口号。 策略应用定义了报文包含的应用程序。同时支持用户定义访问策略有效的时段，即访问时间，即在哪一天或哪一时段访问策略有效；支持IPv6 扩展头的访问控制（逐跳扩展头|分段扩展头|目的扩展头|认证扩展头|路由扩展头|ESP扩展头）。 访问控制定义了对满足策略的报文所采取的处理方式，包括允许（该报文被允许通过） 、禁止（丢弃该包）和认证 。
　　一个报文和某一条访问策略匹配指的是：报文的源地址包含于策略源定义、报文目的地址包含于策略目的，以及报文端口包含于策略服务，如果定义了访问时间，则报文的接收时间也必须满足策略访问时间约束。 只有当一个报文完全符合策略中所规定的所有条件时，这条策略才匹配该报文。

##### 1.2 规则配置

　　通过访问控制规则的设置对设备各个接口之间的数据转发进行控制。访问控制规则分为两部分：过滤条件和行为，过滤条件由安全域间流量的源安全域/源地址、 目的安全域/目的地址、服务类型、 时间等构成。 策略规则都有其独有的 ID 号， 策略规则 ID 会在定义规则时自动生成。 所有策略规则有特定的排列顺序，也可以设置策略规则的排列位置。
　　在数据包进入系统时，系统会对数据包按照找到的第一条与过滤条件相匹配的策略规则进行处理。 同时，对于定义的策略规则，提供了对规则的分组管理功能，不同组之间的前后顺序和组内规则的排列顺序共同决定访问控制规则的匹配顺序。

##### 1.3 访问控制列表（Access Control List，ACL）

　　访问控制列表（Access Control List，ACL）是应用在路由器接口的指令列表，用于路由器利用源地址、目的地址、端口号等的特定指示条件对数据包的抉择。是以文件为中心建立访问权限表，表中记载了该文件的访问用户名和权隶属关系。利用ACL，容易判断出对特定客体的授权访问，可访问的主体和访问权限等。当将该客体的ACL置为空，可撤消特定客体的授权访问。

### 防火墙技术

#### 概念

它是一种位于**内部网络与外部网络**之间的网络安全系统。是一项[信息安全](https://so.csdn.net/so/search?q=信息安全&spm=1001.2101.3001.7020)的防护系统，依照特定的规则，允许或是限制传输的数据通过

在网络的世界里，要由防火墙过滤的就是承载通信数据的通信包。

        在网络中，所谓“防火墙”，是指一种将内部网和公众访问网（如Internet）分开的方法，它实际上是一种隔离技术。防火墙是在两个网络通讯时执行的一种访问控制尺度，它能允许你“同意”的人和数据进入你的网络，同时将你“不同意”的人和数据拒之门外，最大限度地阻止网络中的黑客来访问你的网络。换句话说，如果不通过防火墙，公司内部的人就无法访问Internet，Internet上的人也无法和公司内部的人进行通信。

## 入侵防御系统

### 入侵手段

#### 恶意代码

#### 非法访问

#### 拒绝服务攻击

## 数字签名技术

### 简介

#### 数字签名 : 证明 数据 或 身份的 真实性 ; 需要有以下功能 :

① 报文鉴别 : 用于 证明来源 , 接收者 可以 通过签名 确定 是哪个发送者 进行的签名 ;

② 防止抵赖 : 防止 发送者 否认签名 , 发送者 一旦签名 , 标记就打上了 , 无法抵赖 ;

③ 防止伪造 : 防止 接收者 伪造 发送者 的签名 ;	

**数字签名就是对数字信息进行签名，以防止他人对信息进行伪造和篡改，也可以用于身份识别**

#### 特征

- 签名是可信的
- 签名的信息是不可篡改的
- 签名是不可复制的
- 签名是不可伪造的
- 签名是不可抵赖的





作用

用于证明真实性。
数字签名必须保证以下三点：
(1) 报文鉴别——接收者能够核实发送者对报文的签名（证明 来源）；
(2) 报文的完整性——发送者事后不能抵赖对报文的签名（防 否认）；
(3) 不可否认——接收者不能伪造对报文的签名（防伪造）。
现在已有多种实现各种数字签名的方法。但采用公钥算法更容易实现。

[![zF4b6O.jpg](https://s1.ax1x.com/2022/11/13/zF4b6O.jpg)](https://imgse.com/i/zF4b6O)



基于公钥的数字签名的实现

    因为除 A 外没有别人能具有 A 的私钥，所以除 A 外没有别人能产生这个密文。因此 B 相信报 文 X 是 A 签名发送的。
    若 A 要抵赖曾发送报文给 B，B 可将明文和对 应的密文出示给第三者。第三者很容易用 A 的 公钥去证实 A 确实发送 X 给 B。
    反之，若 B 将 X 伪造成 X‘，则 B 不能在第三者前出示对应的密文。这样就证明了 B 伪造了 报文。

[![zF4qXD.jpg](https://s1.ax1x.com/2022/11/13/zF4qXD.jpg)](https://imgse.com/i/zF4qXD)



## 具有保密性的数字签名

同时实现秘密通信和数字签名

#### 二、基于公钥的数字签名实现

数字签名实现方式 : 数字签名算法很多 , 公钥算法 是最简单的算法 , 即 发送者 使用 私钥加密数据 , 接收者 使用 对应的公钥 解密数据 ;

( 接收者 持有着大量公钥 )



#### 三、数字签名 功能

数字签名 功能 : 以 发送者 使用 私钥 加密密文 , 接收者 使用 公钥 解密密文 为例 ;

① 报文鉴别 : 发送者 持有 私钥 , 使用该私钥 加密密文 , 除了该 发送者之外 , 其它人无法产生该密文 , 接收者 使用 公钥解密出正确的信息 , 因此 接收者 相信 该密文 是发送者 使用私钥加密 并 发出的 ;

② 防止抵赖 : 如果发送者 抵赖 , 接收者可以将 密文 , 公钥 , 明文 , 提供给第三方进行验证 , 将密文通过公钥解密成明文 , 就能证明该密文是指定的发送者发送的 ;

③ 防止伪造 : 接收者 伪造了 密文 , 如果 接收者 将 伪造的 密文 , 公钥 , 明文 , 提供给第三方 , 使用 公钥 , 无法将密文解密成明文 , 证明该签名是伪造的 ;



#### 四、保密数字签名

数字签名弊端 :

① 数据窃取 : A A A 的公钥可能有很多人持有 , 如果一个持有 A A A 公钥的一方截获了上述签名数据 , 就会被窃取数据 ;

② 解决方案 签名 + 公钥加密 : 在 A A A 数字签名基础上 , 再进行公钥加密 , 就将数据保密了 , 只有对应私钥才能对其进行解密 ;


保密数字签名实现方式 :

① 加密 : 发送者 A A A 使用 A A A 的私钥 S K A SK_A SKA ( Secret Key A ) 加密数据 , 然后在 使用 接收者 B B B 的公钥 P K B PK_B PKB ( Public Key B ) 加密数据 ;

② 解密 : 接收者 B B B 使用 B B B 的私钥 S K B SK_B SKB ( Secret Key B ) 解密数据 , 然后再 使用 发送者 A A A 的公钥 P K A PK_A PKA 解密数据 , 最终得到明文 ;


保密数字签名实现方式优势 : 接收者 B B B 既可以识别 发送者 A A A 的身份 , 又能保证数据不会被截获 ;





# 防火墙

## 简介

防火墙在计算机术语中是一种用来隔离两个或多个网络的软硬件一体的网络设备。它位于多个网络的连接处，如本地网与[广域网](https://so.csdn.net/so/search?q=广域网&spm=1001.2101.3001.7020)的连接处等网络位置，通过安全策略控制网络之间的数据流向及数据包是否放行、阻断或丢弃。

## 发展

第一代防火墙：包过滤防火墙

第二代防火墙：应用代理防火墙

第三代防火墙：状态检测防火墙

第四代防火墙：统一威胁管理（UTM）

第五代防火墙：下一代防火墙

## 技术

包过滤防火墙：通过制定ACL（访问控制列表）对数据包的五元组（源IP、目的IP、源端口号、目的端口号、协议号）进行过滤，符合放行策略的数据包允许通过，其他的数据包不允许通过设备，是工作在OSI模型的三层及四层。

应用代理防火墙：通过部署在网络出口处，代理网络内的客户端执行应用层数据连接，提供代理服务，是工作在OSI模型的七层应用层。

状态检测防火墙：状态检测防火墙在包过滤防火墙的基础之上增加了会话机制，通过建立动态的会话机制，要比包过滤防火墙速度更快，安全性更高。当数据包经过设备时，设备通过分析数据包的五元组并建立会话表，该会话的后续数据包到达设备后就可以直接放行通过，当会话结束后删除会话。

统一威胁管理：在状态检测防火墙的基础之上，集成了VPN、防病毒、入侵检测等功能，由于其集成功能更多，若开启全部功能对其硬件性能也带来很高的要求。

下一代防火墙：下一代防火墙是目前市面上的主流防火墙，它在之前防火墙的基础上通过防火墙策略匹配、建立会话表、识别应用、内容检测等功能，在提高安全性的同时降低了设备的性能要求，同时也集成了VPN，防病毒、入侵检测等功能。

## 模式

防火墙的部署模式有路由模式、透明模式、混合模式。

路由模式：防火墙在出口处部署，除安全防护功能外，还充当路由角色，在出口配置NAT功能。

透明模式：防火墙串联部署于网络出口或者DMZ区域，设备工作在二层模式，根据MAC地址表进行数据转发，同时还具有防火墙的包过滤、检测等安全功能。

混合模式：防火墙根据业务需求及端口的划分同时具备路由模式和透明模式的两种工作模式进行部署。

## 区域划分

**安全区域**



在防火墙中，安全区域（Security Zone），简称为区域（zone），是一个或多个接口的组合，这些接口所包含的用户具有相同的安全属性。每个安全区域具有全局唯一的安全优先级，即不存在两个具有相同优先级的安全区域。



设备认为在同一安全区域内部发生的数据流动是可信的，不需要实施任何安全策略。只有当不同安全区域之间发生数据流动时，才会触发防火墙的安全检查，并实施相应的安全策略。


**安全域间**
任何两个安全区域都构成一个安全域间（Interzone），并具有单独的安全域间视图，大部分的防火墙配置都在安全域间视图下配置。



例如：配置了安全区域 zone1 和 zone2，则在 zone1 和 zone2 的安全域间视图中，可以配置 ACL 包过滤功能，表示对 zone1 和 zone2 之间发生的数据流动实施 ACL 包过滤。



在安全域间使能防火墙功能后，当高优先级的用户访问低优先级区域时，防火墙会记录报文的 IP、 VPN 等信息，生成一个流表。当报文返回时，设备会查看报文的 IP、 VPN  等信息，因为流表里记录有发出报文的信息，所以有对应的表项，返回的报文能通过。低优先级的用户访问高优先级用户时，默认是不允许访问的。因此，把内网设置为高优先级区域，外网设置为低优先级区域，内网用户可以主动访问外网，外网用户则不能主动访问内网。



**基于安全域的防火墙的优点**


传统的交换机/路由器的策略配置通常都是围绕报文入接口、出接口展开的，随着防火墙的不断发展，已经逐渐摆脱了只连接外网和内网的角色，出现了内网/外网/DMZ（Demilitarized  Zone）的模式，并且向着提供高端口密度的方向发展。在这种组网环境中，传统基于接口的策略配置方式给网络管理员带来了极大的负担，安全策略的维护工作量成倍增加，从而也增加了因为配置引入安全风险的概率。



除了复杂的基于接口的安全策略配置，某些防火墙支持全局的策略配置，全局策略配置的缺点是配置粒度过粗，一台设备只能配置同样的安全策略，满足不了用户在不同安全区域或者不同接口上实施不同安全策略的要求，使用上具有明显的局限性。



基于安全域的防火墙支持基于安全区域的配置方式，所有攻击检测策略均配置在安全区域上，配置简洁又不失灵活性，既降低网络管理员配置负担，又能满足复杂组网情况下针对安全区域实施不同攻击防范策略的要求。

## 工作模式

**路由模式：**如果设备接口具有 IP 地址通过三层与外连接，则认为该接口工作在路由模式下。

**透明模式：**如果设备接口无 IP 地址通过二层对外连接，则认为该接口工作在透明模式下。

如果设备既存在工作在路由模式的接口（接口具有 IP 地址），又存在工作在透明模式的接口（接口无 IP 地址），则认为该设备工作在**混合模式**下。

**1、路由模式**当设备位于内部网络和外部网络之间，同时为设备与内部网络、外部网络相连的接口分别配置不同网段的 IP 地址，并重新规划原有的网络拓扑结构。

如图所示，规划了 2 个安全区域：Trust 区域和 Untrust 区域，设备的 Trust 区域接口与公司内部网络相连， Untrust区域接口与外部网络相连。

需要注意的是， Trust 区域接口和 Untrust 区域接口分别处于两个不同的子网中。

路由模式组网图

[![zF56UA.jpg](https://s1.ax1x.com/2022/11/13/zF56UA.jpg)](https://imgse.com/i/zF56UA)



**2、透明模式**


如果设备工作在透明模式，则可以避免改变拓扑结构。此时，设备对于子网用户来说是完全透明的，即用户感觉不到设备的存在。

设备透明模式的典型组网方式如图所示。设备的 Trust 区域接口与公司内部网络相连， Untrust 区域接口与外部网络相连。需要注意的是， Trust 区域接口和 Untrust 区域接口必须处于同一个子网中。

透明模式组网图

[![zF5fv8.jpg](https://s1.ax1x.com/2022/11/13/zF5fv8.jpg)](https://imgse.com/i/zF5fv8)









[![zF55Dg.jpg](https://s1.ax1x.com/2022/11/13/zF55Dg.jpg)](https://imgse.com/i/zF55Dg)